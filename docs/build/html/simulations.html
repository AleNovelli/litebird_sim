
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Simulations &#8212; LiteBIRD simulation pipeline 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Tutorial" href="tutorial.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="simulations">
<h1>Simulations<a class="headerlink" href="#simulations" title="Permalink to this headline">¶</a></h1>
<p>Describe how to use a <a class="reference internal" href="#litebird_sim.simulations.Simulation" title="litebird_sim.simulations.Simulation"><code class="xref py py-class docutils literal notranslate"><span class="pre">litebird_sim.simulations.Simulation</span></code></a>
object.</p>
<div class="section" id="generation-of-reports">
<h2>Generation of reports<a class="headerlink" href="#generation-of-reports" title="Permalink to this headline">¶</a></h2>
<p>This section should explain how reports can be generated, first from
the perspective of a library user, and then describing how developers
can generate plots for their own modules.</p>
<p>Here is an example, showing several advanced topics like mathematical
formulae, plots, and value substitution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">litebird_sim</span> <span class="k">as</span> <span class="nn">lbs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">lbs</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;My simulation&quot;</span><span class="p">,</span> <span class="n">base_path</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
<span class="n">data_points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>

<span class="n">sim</span><span class="o">.</span><span class="n">append_to_report</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Here is a formula for $`f(x)`$:</span>

<span class="s1">```math</span>
<span class="s1">f(x) = \sin x</span>
<span class="s1">```</span>

<span class="s1">And here is a completely unrelated plot:</span>

<span class="s1">![](myplot.png)</span>

<span class="s1">The data points have the following values:</span>
<span class="s1">{</span><span class="si">% f</span><span class="s1">or sample in data_points %}</span>
<span class="s1">- {{ sample }}</span>
<span class="s1">{</span><span class="si">% e</span><span class="s1">ndfor %}</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span> <span class="n">figures</span><span class="o">=</span><span class="p">[(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;myplot.png&quot;</span><span class="p">)],</span>
     <span class="n">data_points</span><span class="o">=</span><span class="n">data_points</span><span class="p">)</span>

<span class="n">sim</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="module-litebird_sim.simulations">
<span id="api-reference"></span><h2>API reference<a class="headerlink" href="#module-litebird_sim.simulations" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="litebird_sim.simulations.OutputFileRecord">
<em class="property">class </em><code class="sig-prename descclassname">litebird_sim.simulations.</code><code class="sig-name descname">OutputFileRecord</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">description</em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.simulations.OutputFileRecord" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="method">
<dt id="litebird_sim.simulations.OutputFileRecord.description">
<em class="property">property </em><code class="sig-name descname">description</code><a class="headerlink" href="#litebird_sim.simulations.OutputFileRecord.description" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="method">
<dt id="litebird_sim.simulations.OutputFileRecord.path">
<em class="property">property </em><code class="sig-name descname">path</code><a class="headerlink" href="#litebird_sim.simulations.OutputFileRecord.path" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="litebird_sim.simulations.Simulation">
<em class="property">class </em><code class="sig-prename descclassname">litebird_sim.simulations.</code><code class="sig-name descname">Simulation</code><span class="sig-paren">(</span><em class="sig-param">base_path=PosixPath('.')</em>, <em class="sig-param">name=None</em>, <em class="sig-param">use_mpi=False</em>, <em class="sig-param">description=''</em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.simulations.Simulation" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A container object for running simulations</p>
<p>This is the most important class in the Litebird_sim framework. It
initializes an output directory that will contain all the products
of a simulation and will handle the generation of reports and
writing of output files.</p>
<p>Be sure to call <a class="reference internal" href="#litebird_sim.simulations.Simulation.flush" title="litebird_sim.simulations.Simulation.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Simulation.flush()</span></code></a> when the simulation is
completed. This ensures that all the information are saved to disk
before the completion of your script.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_path</strong> – (either a <code class="docutils literal notranslate"><span class="pre">str</span></code> or <code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> object): the
folder that will contain the output. If this folder does not
exist and the user has sufficient rights, it will be created.</p></li>
<li><p><strong>name</strong> – a string identifying the simulation. This will
be used in the reports.</p></li>
<li><p><strong>bool</strong> (<em>use_mpi</em>) – a Boolean flag specifying if the simulation
should take advantage of MPI or not.</p></li>
<li><p><strong>str</strong> (<em>description</em>) – a (possibly long) description of the
simulation, to be put in the report saved in <cite>base_path</cite>).</p></li>
</ul>
</dd>
</dl>
<p>You can access the fields <cite>base_path</cite>, <cite>name</cite>, <cite>use_mpi</cite>, and
<cite>description</cite> in the <cite>Simulation</cite> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">litebird_sim</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;My simulation&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running </span><span class="si">{sim.name}</span><span class="s2">, saving results in </span><span class="si">{sim.base_path}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This class keeps track of any output file saved in <cite>base_path</cite>
through the member variable <cite>self.list_of_outputs</cite>. This is a list
of objects of type <a class="reference internal" href="#litebird_sim.simulations.OutputFileRecord" title="litebird_sim.simulations.OutputFileRecord"><code class="xref py py-meth docutils literal notranslate"><span class="pre">OutputFileRecord()</span></code></a>, which are 2-tuples
of the form <code class="docutils literal notranslate"><span class="pre">(path,</span> <span class="pre">description)</span></code>, where <code class="docutils literal notranslate"><span class="pre">path</span></code> is a
<code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> object and <code class="docutils literal notranslate"><span class="pre">description</span></code> is a <cite>str</cite> object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">curpath</span><span class="p">,</span> <span class="n">curdescr</span> <span class="ow">in</span> <span class="n">sim</span><span class="o">.</span><span class="n">list_of_outputs</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{curpath}</span><span class="s2">: </span><span class="si">{curdescr}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="litebird_sim.simulations.Simulation.append_to_report">
<code class="sig-name descname">append_to_report</code><span class="sig-paren">(</span><em class="sig-param">markdown_text: str</em>, <em class="sig-param">figures: List[Tuple[Any</em>, <em class="sig-param">str]] = []</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.simulations.Simulation.append_to_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Append text and figures to the simulation report</p>
<p>A Simulation class can generate reports in Markdown
format. Use this function to add some text to the report,
possibly including figures.</p>
<p>It is possible to use objects other than Matplotlib
figures. The only method this function calls is <cite>savefig</cite>,
with no arguments.</p>
<p>Images are saved immediately during the call, but the text
will be written to disk only when
<code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code> is called.</p>
<p>You can put LaTeX formulae in the text, using <code class="docutils literal notranslate"><span class="pre">$`...`$</span></code>
for inline equations and the <cite>math</cite> tag in fenced text for
displayed equations.</p>
<p>Parameters:</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>str</strong> (<em>markdown_text</em>) – text to be appended to the report.</p></li>
<li><p><strong>figures</strong> – (list of 2-tuples containing a Matplotlib
figure and a <code class="docutils literal notranslate"><span class="pre">str</span></code>) list of Matplotlib figures to be saved
in the report. Each tuple must contain one figure and one
filename. The figures will be saved using the specified file
name in the output directory. The file name must match the
one used as reference in the Markdown text.</p></li>
<li><p><strong>kwargs</strong> – any other keyword argument will be used to
expand the text <cite>markdown_text</cite> using the <a class="reference external" href="https://palletsprojects.com/p/jinja/">Jinja2 library</a> library.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="litebird_sim.simulations.Simulation.flush">
<code class="sig-name descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#litebird_sim.simulations.Simulation.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Terminate a simulation.</p>
<p>This function must be called when a simulation is complete. It
will save pending data to the output directory.</p>
</dd></dl>

<dl class="method">
<dt id="litebird_sim.simulations.Simulation.write_healpix_map">
<code class="sig-name descname">write_healpix_map</code><span class="sig-paren">(</span><em class="sig-param">filename: str</em>, <em class="sig-param">pixels</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#litebird_sim.simulations.Simulation.write_healpix_map" title="Permalink to this definition">¶</a></dt>
<dd><p>Save a Healpix map in the output folder</p>
<p>This function saves an Healpix map into a FITS files that is
written into the output folder for the simulation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – (<code class="docutils literal notranslate"><span class="pre">str</span></code> or <code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code>) name of the
file. It can contain subdirectories.</p></li>
<li><p><strong>pixels</strong> – array containing the pixels, or list of arrays if
you want to save several maps into the same FITS table
(e.g., I, Q, U components)</p></li>
</ul>
</dd>
</dl>
<p>The function returns a <code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> object containing the
path of the FITS file that has been saved.</p>
<p>Here is a simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="n">base_path</span><span class="o">=</span><span class="s2">&quot;/storage/litebird/mysim&quot;</span><span class="p">)</span>
<span class="n">pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">sim</span><span class="o">.</span><span class="n">write_healpix_map</span><span class="p">(</span><span class="s2">&quot;zero_map.fits.gz&quot;</span><span class="p">,</span> <span class="n">pixels</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">LiteBIRD simulation pipeline</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#generation-of-reports">Generation of reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-litebird_sim.simulations">API reference</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tutorial.html" title="previous chapter">Tutorial</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, The LiteBIRD Simulation Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/simulations.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>